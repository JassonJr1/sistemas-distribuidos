import socket
import threading
from cryptography.fernet import Fernet

key = Fernet.generate_key()
cipher_suite = Fernet(key)

HOST = ''  # Endereço IP do servidor
PORT = 12345  # Porta do servidor
BUFFER_SIZE = 1024  # Tamanho do buffer para receber dados

server_socket = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
server_socket.bind((HOST, PORT))
server_socket.listen(5)  # Permitir até 5 conexões simultâneas

def handle_client(conn, addr):
    while True:
        data = conn.recv(BUFFER_SIZE)
        if not data:
            break
        decrypted_data = cipher_suite.decrypt(data)
        # fazer algo com a mensagem descriptografada
        conn.sendall(cipher_suite.encrypt(response))
    conn.close()

while True:
    conn, addr = server_socket.accept()
    print('Conectado por', addr)
    threading.Thread(target=handle_client, args=(conn, addr)).start()
